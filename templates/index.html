<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUAM - Sistema de Acceso</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Segoe UI", Roboto, sans-serif; }
        html, body { height: 100%; overflow: hidden; background-color: #f4f4f4; }

        .app-container { display: flex; flex-direction: column; height: 100vh; }
        .top-bar {
            background-color: white; padding: 1rem 2rem; font-size: 1.5rem; font-weight: 600;
            color: #FD441E; display: flex; align-items: center; gap: 0.75rem; box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .top-bar-logo { height: 32px; width: auto; }

        .main-content { display: flex; flex-grow: 1; height: calc(100% - 60px); }

        .form-panel {
            flex-basis: 500px; flex-shrink: 0; background-color: white; padding: 2rem;
            display: flex; flex-direction: column; align-items: center; overflow-y: auto;
        }

        .logo-circle {
            width: 80px; height: 80px; border-radius: 50%; background-color: #f0f0f0; color: #FD441E;
            display: grid; place-items: center; font-size: 3rem; font-weight: bold; margin-bottom: 2rem;
        }

        .form-wrapper { width: 100%; max-width: 400px; }
        .form-view { display: none; }
        .form-view.active { display: block; }

        .form-view h2 { text-align: center; color: #FD441E; margin-bottom: 1rem; }
        .form-view .subtitle { text-align: center; color: #666; margin-bottom: 2rem; }

        form { display: flex; flex-direction: column; gap: 1rem; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: 600; margin-bottom: 0.5rem; color: #555; }
        .form-group input, .form-group select {
            padding: 0.9rem; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem;
        }

        .form-group-inline { display: flex; gap: 1rem; }
        .form-group-inline .form-group:first-child { flex-basis: 30%; }

        .input-with-button { display: flex; gap: 0.5rem; }
        .input-with-button input { flex-grow: 1; }
        .input-with-button button {
            padding: 0.5rem 0.8rem; border: 1px solid #ccc; background: #f0f0f0;
            cursor: pointer; border-radius: 8px; font-size: 0.9rem;
        }

        .btn-primary {
            background-color: #FD441E; color: white; border: none; padding: 1rem;
            border-radius: 8px; font-size: 1rem; font-weight: bold; cursor: pointer;
            transition: background-color 0.2s;
        }
        .btn-primary:hover { background-color: #e03c1a; }

        .form-links { margin-top: 1.5rem; display: flex; justify-content: center; gap: 2rem; }
        .form-links a { color: #FD441E; text-decoration: underline; cursor: pointer; }
        .decorative-panel { flex-grow: 1; background-color: #333; background-image: url("/static/img/imagen_nuam.webp"); background-size: cover; background-position: center; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="top-bar">
            <img src="/static/img/Nuam.png" alt="Nuam Logo" class="top-bar-logo"> nuam
        </header>

        <main class="main-content">
            <div class="form-panel">
                <div class="logo-circle">N</div>
                <div class="form-wrapper">

                    <!-- LOGIN -->
                    <div id="login-view" class="form-view active">
                        <h2>Inicio Sesi√≥n</h2>
                        <form onsubmit="handleLogin(event)">
                            <div class="form-group">
                                <label for="login-email">Email</label>
                                <input type="email" id="login-email" placeholder="Correo corporativo" required>
                            </div>
                            <div class="form-group">
                                <label for="login-pass">Contrase√±a</label>
                                <input type="password" id="login-pass" placeholder="Contrase√±a" required>
                            </div>
                            <button type="submit" class="btn-primary">Iniciar sesi√≥n</button>
                        </form>
                        <div class="form-links">
                            <a onclick="showView('recover-view')">¬øOlvidaste tu contrase√±a?</a>
                            <a onclick="showView('register-view')">Reg√≠strate aqu√≠</a>
                        </div>
                    </div>

                    <!-- RECUPERAR -->
                    <div id="recover-view" class="form-view">
                        <h2>Recuperar Contrase√±a</h2>
                        <form onsubmit="handleRecover(event)">
                            <div class="form-group">
                                <label for="recover-email">Email Corporativo</label>
                                <input type="email" id="recover-email" required>
                            </div>
                            <button type="submit" class="btn-primary">Enviar</button>
                        </form>
                        <div class="form-links"><a onclick="showView('login-view')">Volver</a></div>
                    </div>

                    <!-- REGISTRO -->
                    <div id="register-view" class="form-view">
                        <h2>Registro</h2>
                        <form onsubmit="handleRegister(event)">
                            <div class="form-group">
                                <label for="reg-nombres">Nombres</label>
                                <input type="text" id="reg-nombres" required>
                            </div>
                            <div class="form-group">
                                <label for="reg-email">Email</label>
                                <input type="email" id="reg-email" required>
                            </div>
                            <div class="form-group">
                                <label for="reg-pass">Contrase√±a</label>
                                <input type="password" id="reg-pass" required>
                            </div>
                            <button type="submit" class="btn-primary">Registrarse</button>
                        </form>
                        <div class="form-links"><a onclick="showView('login-view')">Volver</a></div>
                    </div>

                </div>
            </div>

            <div class="decorative-panel"></div>
        </main>
    </div>

    <!-- üîó CONEXI√ìN CON BACKEND -->
    <script>
        const API_BASE = "http://127.0.0.1:8000/api";

        function showView(viewId) {
            document.querySelectorAll('.form-view').forEach(v => v.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById("login-email").value;
            const password = document.getElementById("login-pass").value;
            try {
                const res = await fetch(`${API_BASE}/auth/token/`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username: email, password })
                });
                if (!res.ok) throw new Error("Credenciales incorrectas");
                const data = await res.json();
                localStorage.setItem("access", data.access);
                alert("Inicio de sesi√≥n exitoso ‚úÖ");
                window.location.href = "/dashboard"; // cambia seg√∫n tu template
            } catch (err) {
                alert(err.message);
            }
        }

        async function handleRegister(e) {
            e.preventDefault();
            const payload = {
                username: document.getElementById("reg-email").value,
                email: document.getElementById("reg-email").value,
                password: document.getElementById("reg-pass").value,
                first_name: document.getElementById("reg-nombres").value
            };
            try {
                const res = await fetch(`${API_BASE}/users/`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });
                if (!res.ok) throw new Error("Error al registrar usuario");
                alert("Registro enviado con √©xito. Espera aprobaci√≥n ‚úÖ");
                showView('login-view');
            } catch (err) {
                alert(err.message);
            }
        }

        function handleRecover(e) {
            e.preventDefault();
            const email = document.getElementById("recover-email").value;
            alert(`Simulando recuperaci√≥n de contrase√±a para ${email}`);
            showView("login-view");
        }
    </script>
</body>
</html>
