{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h2>NUAM</h2>
    </div>
</div>

<div class="row">
    <!-- Estadísticas Generales -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Calificaciones Totales</h5>
                <h2>{{ total_calificaciones }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Usuarios Registrados</h5>
                <h2>{{ total_usuarios }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Instrumentos</h5>
                <h2>{{ total_instrumentos }}</h2>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Gráfico de Calificaciones por Mes -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Calificaciones por Mes</h5>
                <canvas id="calificacionesMesChart"></canvas>
            </div>
        </div>
    </div>
    <!-- Gráfico de Estados -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Calificaciones por Estado</h5>
                <canvas id="calificacionesEstadoChart"></canvas>
            </div>
        </div>
    </div>
</div>

{% block extrajs %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Datos para el gráfico de calificaciones por mes
    const calificacionesMesData = {{ calificaciones_mes|safe }};
    const calificacionesEstadoData = {{ calificaciones_estado|safe }};

    // Gráfico de línea para calificaciones por mes
    new Chart(document.getElementById('calificacionesMesChart'), {
        type: 'line',
        data: {
            labels: calificacionesMesData.map(d => new Date(d.month).toLocaleDateString()),
            datasets: [{
                label: 'Calificaciones',
                data: calificacionesMesData.map(d => d.total),
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1
            }]
        }
    });

    // Gráfico de torta para calificaciones por estado
    new Chart(document.getElementById('calificacionesEstadoChart'), {
        type: 'pie',
        data: {
            labels: calificacionesEstadoData.map(d => d.estado__nombre),
            datasets: [{
                data: calificacionesEstadoData.map(d => d.total),
                backgroundColor: [
                    'rgb(255, 99, 132)',
                    'rgb(54, 162, 235)',
                    'rgb(255, 205, 86)',
                    'rgb(75, 192, 192)'
                ]
            }]
        }
    });
</script>
{% endblock %}
{% endblock %}